<!-- <!DOCTYPE html>
<html lang="en">

<body>

  <script type="module">
    import { createSprite } from './sprites.js';
    const socket = io();

    async function getData() {
      const data = await fetch('http://localhost:3000/char');
      const res = await data.json();
      return res;
    }

    async function getTeam() {
      const data = await fetch('http://localhost:3000/team');
      const res = await data.json();
      return res;
    }

    async function getTeamO() {
      const data = await fetch('http://localhost:3000/teamOpponent');
      const res = await data.json();
      return res;
    }

    const result = await getData();
    const results = await getTeam();
    const teamOpponent = await getTeamO();

    class Example extends Phaser.Scene {
      #userTeam = results;
      #teamOpponent = teamOpponent;

      #char = null;
      #oChar = null;

      preload() {
        this.load.atlas('cap', 'assets/captain/cap.png', 'assets/captain/cap.json');
      }

      create() {
        this.#char = createSprite(this.#userTeam[0], this, { x: 200, y: 200, isFlip: false });
        this.#oChar = createSprite(this.#teamOpponent[0], this, { x: 600, y: 200, isFlip: true });

        // Draw Skills
        const txt0 = this.add.text(100, 400, this.#char.skills[0].name, { color: '#00ff00' }).setOrigin(0, 0.5);
        const txt1 = this.add.text(200, 400, this.#char.skills[1].name, { color: '#00ff00' }).setOrigin(0, 0.5);

        txt0.setInteractive();
        txt1.setInteractive();

        txt0.on('pointerdown', () => {
          this.#char.skillSelected(this.#char.skills[0].id);
        });

        txt1.on('pointerdown', () => {
          console.log(this.#char.skills[1].name)
        });

        this.#oChar.sprite.on('pointerover', () => {
          this.#oChar.sprite.setTint(0x7878ff);
        });

        this.#oChar.sprite.on('pointerout', () => {
          this.#oChar.sprite.clearTint();
        });

        this.#oChar.sprite.on('pointerdown', () => {
          this.#char.targetSelected(this.#oChar);
        });
      }

      // update() {
      //   // enable action effects
      //   // const { enableSkillAction } = this.#char.update();
      //   // if (enableSkillAction) {
      //   // }
      // }
    }

    const config = {
      type: Phaser.AUTO,
      pixelArt: true,
      width: 800,
      height: 600,
      scene: Example
    };

    const game = new Phaser.Game(config);
  </script>

</body>

</html> -->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <title>Document</title>
</head>

<body>
  aqui

  <script type="module">
    // dependencies
    import { socketEvents } from './config.js';
    import { createSprite, createSpriteDemo } from './sprites.js';

    const socket = io();

    socket.on('connect', () => {
      console.log('ConexÃ£o aberta')
    });

    // CONECTION WITH SERVER
    socket.on(socketEvents.initState, (state) => {
      initGame(state);
    });

    function initGame(state) {
      class Battle extends Phaser.Scene {
        #STATE = null;
        #enableTargets = false;
        #userTeam = [];
        #adversaryTeam = [];

        preload() {
          this.#STATE = state;
          console.log('STATE --->', state)
          this.load.atlas('cap', 'assets/captain/cap.png', 'assets/captain/cap.json');
        }

        create() {
          let c = 1;
          for (const userChar of this.#STATE.userTeam) {
            this.#userTeam.push(createSpriteDemo(userChar, this, { x: 200, y: 100 * c, isFlip: false }));
            c++
          }

          let y = 1;
          for (const adversaryChar of this.#STATE.adversaryTeam) {
            this.#adversaryTeam.push(createSpriteDemo(adversaryChar, this, { x: 400, y: 100 * y, isFlip: true }));
            y++
          }

          // Draw Skills
          if (Object.keys(this.#STATE.currentChar).includes('skills')) {
            this.drawSkills();
          }

          const char = this.#userTeam.find(c => c.id === this.#STATE.currentChar.id);

          this.#adversaryTeam[0].sprite.on('pointerdown', () => {
            char.targetSelected(this.#adversaryTeam[0].name);
            this.#enableTargets = false;
          });
        }

        update() {
          if (this.#enableTargets) {
            this.#adversaryTeam[0].sprite.setTint(0x7878ff);
          } else {
            this.#adversaryTeam[0].sprite.clearTint();
          }
        }

        drawSkills() {
          const action01 = this.add.text(50, 400, this.#STATE.currentChar.skills[0].name, { color: '#00ff00' }).setInteractive();
          const action02 = this.add.text(200, 400, this.#STATE.currentChar.skills[1].name, { color: '#00ff00' }).setInteractive();
          const recharge = this.add.text(300, 400, 'RECARGA', { color: '#00ff00' }).setInteractive();

          const char = this.#userTeam.find(c => c.id === this.#STATE.currentChar.id);

          action01.on('pointerdown', () => {
            char.skillSelected(char.skills[0].id);
            this.#enableTargets = true;
          });

          action02.on('pointerdown', () => {
            char.skillSelected(char.skills[1].id);
          });

          recharge.on('pointerdown', () => {
            console.log('recarregar')
          });
        }
      }

      const config = {
        type: Phaser.AUTO,
        pixelArt: true,
        width: 800,
        height: 600,
        scene: Battle
      };

      const game = new Phaser.Game(config);
    }

    // GAME
  </script>
</body>

</html>